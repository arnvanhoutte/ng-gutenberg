{"version":3,"sources":["@wordpress/block-library/src/gallery/edit.js"],"names":["classnames","every","filter","find","forEach","map","some","compose","PanelBody","RangeControl","SelectControl","ToggleControl","withNotices","BlockIcon","MediaPlaceholder","InspectorControls","RichText","Component","__","sprintf","getBlobByURL","isBlobURL","revokeBlobURL","withSelect","GalleryImage","icon","defaultColumnsNumber","pickRelevantMediaFiles","MAX_COLUMNS","linkOptions","value","label","ALLOWED_MEDIA_TYPES","GalleryEdit","arguments","onSelectImage","bind","onSelectImages","setLinkTo","setColumnsNumber","toggleImageCrop","onMove","onMoveForward","onMoveBackward","onRemoveImage","onUploadError","setImageAttributes","setAttributes","onFocusGalleryCaption","state","selectedImage","attachmentCaptions","attributes","ids","Error","images","props","index","setState","oldIndex","newIndex","splice","length","img","i","columns","Math","min","newImage","currentImage","id","currentImageCaption","caption","attachment","newImages","selectCaption","message","noticeOperations","removeAllNotices","createErrorNotice","linkTo","imageCrop","checked","slice","mediaUpload","url","filesList","onFileChange","allowedTypes","prevProps","isSelected","captionSelected","className","noticeUI","align","hasImages","hasImagesWithId","mediaPlaceholder","title","instructions","undefined","captionClassNames","isEmpty","getImageCropHelp","ariaLabel","alt","attrs","select","getSettings","__experimentalMediaUpload"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\nimport {\n\tevery,\n\tfilter,\n\tfind,\n\tforEach,\n\tmap,\n\tsome,\n} from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { compose } from '@wordpress/compose';\nimport {\n\tPanelBody,\n\tRangeControl,\n\tSelectControl,\n\tToggleControl,\n\twithNotices,\n} from '@wordpress/components';\nimport {\n\tBlockIcon,\n\tMediaPlaceholder,\n\tInspectorControls,\n\tRichText,\n} from '@wordpress/block-editor';\nimport { Component } from '@wordpress/element';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { getBlobByURL, isBlobURL, revokeBlobURL } from '@wordpress/blob';\nimport { withSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport GalleryImage from './gallery-image';\nimport { icon } from './icons';\nimport { defaultColumnsNumber, pickRelevantMediaFiles } from './shared';\n\nconst MAX_COLUMNS = 8;\nconst linkOptions = [\n\t{ value: 'attachment', label: __( 'Attachment Page' ) },\n\t{ value: 'media', label: __( 'Media File' ) },\n\t{ value: 'none', label: __( 'None' ) },\n];\nconst ALLOWED_MEDIA_TYPES = [ 'image' ];\n\nclass GalleryEdit extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.onSelectImage = this.onSelectImage.bind( this );\n\t\tthis.onSelectImages = this.onSelectImages.bind( this );\n\t\tthis.setLinkTo = this.setLinkTo.bind( this );\n\t\tthis.setColumnsNumber = this.setColumnsNumber.bind( this );\n\t\tthis.toggleImageCrop = this.toggleImageCrop.bind( this );\n\t\tthis.onMove = this.onMove.bind( this );\n\t\tthis.onMoveForward = this.onMoveForward.bind( this );\n\t\tthis.onMoveBackward = this.onMoveBackward.bind( this );\n\t\tthis.onRemoveImage = this.onRemoveImage.bind( this );\n\t\tthis.onUploadError = this.onUploadError.bind( this );\n\t\tthis.setImageAttributes = this.setImageAttributes.bind( this );\n\t\tthis.setAttributes = this.setAttributes.bind( this );\n\t\tthis.onFocusGalleryCaption = this.onFocusGalleryCaption.bind( this );\n\n\t\tthis.state = {\n\t\t\tselectedImage: null,\n\t\t\tattachmentCaptions: null,\n\t\t};\n\t}\n\n\tsetAttributes( attributes ) {\n\t\tif ( attributes.ids ) {\n\t\t\tthrow new Error( 'The \"ids\" attribute should not be changed directly. It is managed automatically when \"images\" attribute changes' );\n\t\t}\n\n\t\tif ( attributes.images ) {\n\t\t\tattributes = {\n\t\t\t\t...attributes,\n\t\t\t\tids: map( attributes.images, 'id' ),\n\t\t\t};\n\t\t}\n\n\t\tthis.props.setAttributes( attributes );\n\t}\n\n\tonSelectImage( index ) {\n\t\treturn () => {\n\t\t\tif ( this.state.selectedImage !== index ) {\n\t\t\t\tthis.setState( {\n\t\t\t\t\tselectedImage: index,\n\t\t\t\t} );\n\t\t\t}\n\t\t};\n\t}\n\n\tonMove( oldIndex, newIndex ) {\n\t\tconst images = [ ...this.props.attributes.images ];\n\t\timages.splice( newIndex, 1, this.props.attributes.images[ oldIndex ] );\n\t\timages.splice( oldIndex, 1, this.props.attributes.images[ newIndex ] );\n\t\tthis.setState( { selectedImage: newIndex } );\n\t\tthis.setAttributes( { images } );\n\t}\n\n\tonMoveForward( oldIndex ) {\n\t\treturn () => {\n\t\t\tif ( oldIndex === this.props.attributes.images.length - 1 ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.onMove( oldIndex, oldIndex + 1 );\n\t\t};\n\t}\n\n\tonMoveBackward( oldIndex ) {\n\t\treturn () => {\n\t\t\tif ( oldIndex === 0 ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.onMove( oldIndex, oldIndex - 1 );\n\t\t};\n\t}\n\n\tonRemoveImage( index ) {\n\t\treturn () => {\n\t\t\tconst images = filter( this.props.attributes.images, ( img, i ) => index !== i );\n\t\t\tconst { columns } = this.props.attributes;\n\t\t\tthis.setState( { selectedImage: null } );\n\t\t\tthis.setAttributes( {\n\t\t\t\timages,\n\t\t\t\tcolumns: columns ? Math.min( images.length, columns ) : columns,\n\t\t\t} );\n\t\t};\n\t}\n\n\tselectCaption( newImage, images, attachmentCaptions ) {\n\t\tconst currentImage = find(\n\t\t\timages, { id: newImage.id }\n\t\t);\n\n\t\tconst currentImageCaption = currentImage ? currentImage.caption : newImage.caption;\n\n\t\tif ( ! attachmentCaptions ) {\n\t\t\treturn currentImageCaption;\n\t\t}\n\n\t\tconst attachment = find(\n\t\t\tattachmentCaptions, { id: newImage.id }\n\t\t);\n\n\t\t// if the attachment caption is updated\n\t\tif ( attachment && ( attachment.caption !== newImage.caption ) ) {\n\t\t\treturn newImage.caption;\n\t\t}\n\n\t\treturn currentImageCaption;\n\t}\n\n\tonSelectImages( newImages ) {\n\t\tconst { columns, images } = this.props.attributes;\n\t\tconst { attachmentCaptions } = this.state;\n\t\tthis.setState(\n\t\t\t{\n\t\t\t\tattachmentCaptions: newImages.map( ( newImage ) => ( {\n\t\t\t\t\tid: newImage.id,\n\t\t\t\t\tcaption: newImage.caption,\n\t\t\t\t} ) ),\n\t\t\t}\n\t\t);\n\t\tthis.setAttributes( {\n\t\t\timages: newImages.map( ( newImage ) => ( {\n\t\t\t\t...pickRelevantMediaFiles( newImage ),\n\t\t\t\tcaption: this.selectCaption( newImage, images, attachmentCaptions ),\n\t\t\t} ) ),\n\t\t\tcolumns: columns ? Math.min( newImages.length, columns ) : columns,\n\t\t} );\n\t}\n\n\tonUploadError( message ) {\n\t\tconst { noticeOperations } = this.props;\n\t\tnoticeOperations.removeAllNotices();\n\t\tnoticeOperations.createErrorNotice( message );\n\t}\n\n\tsetLinkTo( value ) {\n\t\tthis.setAttributes( { linkTo: value } );\n\t}\n\n\tsetColumnsNumber( value ) {\n\t\tthis.setAttributes( { columns: value } );\n\t}\n\n\ttoggleImageCrop() {\n\t\tthis.setAttributes( { imageCrop: ! this.props.attributes.imageCrop } );\n\t}\n\n\tgetImageCropHelp( checked ) {\n\t\treturn checked ? __( 'Thumbnails are cropped to align.' ) : __( 'Thumbnails are not cropped.' );\n\t}\n\n\tonFocusGalleryCaption() {\n\t\tthis.setState( {\n\t\t\tselectedImage: null,\n\t\t} );\n\t}\n\n\tsetImageAttributes( index, attributes ) {\n\t\tconst { attributes: { images } } = this.props;\n\t\tconst { setAttributes } = this;\n\t\tif ( ! images[ index ] ) {\n\t\t\treturn;\n\t\t}\n\t\tsetAttributes( {\n\t\t\timages: [\n\t\t\t\t...images.slice( 0, index ),\n\t\t\t\t{\n\t\t\t\t\t...images[ index ],\n\t\t\t\t\t...attributes,\n\t\t\t\t},\n\t\t\t\t...images.slice( index + 1 ),\n\t\t\t],\n\t\t} );\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { attributes, mediaUpload } = this.props;\n\t\tconst { images } = attributes;\n\t\tif ( every( images, ( { url } ) => isBlobURL( url ) ) ) {\n\t\t\tconst filesList = map( images, ( { url } ) => getBlobByURL( url ) );\n\t\t\tforEach( images, ( { url } ) => revokeBlobURL( url ) );\n\t\t\tmediaUpload( {\n\t\t\t\tfilesList,\n\t\t\t\tonFileChange: this.onSelectImages,\n\t\t\t\tallowedTypes: [ 'image' ],\n\t\t\t} );\n\t\t}\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\t// Deselect images when deselecting the block\n\t\tif ( ! this.props.isSelected && prevProps.isSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tselectedImage: null,\n\t\t\t\tcaptionSelected: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tattributes,\n\t\t\tclassName,\n\t\t\tisSelected,\n\t\t\tnoticeUI,\n\t\t\tsetAttributes,\n\t\t} = this.props;\n\t\tconst {\n\t\t\talign,\n\t\t\tcolumns = defaultColumnsNumber( attributes ),\n\t\t\tcaption,\n\t\t\timageCrop,\n\t\t\timages,\n\t\t\tlinkTo,\n\t\t} = attributes;\n\n\t\tconst hasImages = !! images.length;\n\t\tconst hasImagesWithId = hasImages && some( images, ( { id } ) => id );\n\n\t\tconst mediaPlaceholder = (\n\t\t\t<MediaPlaceholder\n\t\t\t\taddToGallery={ hasImagesWithId }\n\t\t\t\tisAppender={ hasImages }\n\t\t\t\tclassName={ className }\n\t\t\t\tdropZoneUIOnly={ hasImages && ! isSelected }\n\t\t\t\ticon={ ! hasImages && <BlockIcon icon={ icon } /> }\n\t\t\t\tlabels={ {\n\t\t\t\t\ttitle: ! hasImages && __( 'Gallery' ),\n\t\t\t\t\tinstructions: ! hasImages && __( 'Drag images, upload new ones or select files from your library.' ),\n\t\t\t\t} }\n\t\t\t\tonSelect={ this.onSelectImages }\n\t\t\t\taccept=\"image/*\"\n\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\tmultiple\n\t\t\t\tvalue={ hasImagesWithId ? images : undefined }\n\t\t\t\tonError={ this.onUploadError }\n\t\t\t\tnotices={ hasImages ? undefined : noticeUI }\n\t\t\t/>\n\t\t);\n\n\t\tif ( ! hasImages ) {\n\t\t\treturn mediaPlaceholder;\n\t\t}\n\n\t\tconst captionClassNames = classnames(\n\t\t\t'blocks-gallery-caption',\n\t\t\t{\n\t\t\t\t'screen-reader-text': ! isSelected && RichText.isEmpty( caption ),\n\t\t\t}\n\t\t);\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<InspectorControls>\n\t\t\t\t\t<PanelBody title={ __( 'Gallery Settings' ) }>\n\t\t\t\t\t\t{ images.length > 1 && <RangeControl\n\t\t\t\t\t\t\tlabel={ __( 'Columns' ) }\n\t\t\t\t\t\t\tvalue={ columns }\n\t\t\t\t\t\t\tonChange={ this.setColumnsNumber }\n\t\t\t\t\t\t\tmin={ 1 }\n\t\t\t\t\t\t\tmax={ Math.min( MAX_COLUMNS, images.length ) }\n\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t/> }\n\t\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\t\tlabel={ __( 'Crop Images' ) }\n\t\t\t\t\t\t\tchecked={ !! imageCrop }\n\t\t\t\t\t\t\tonChange={ this.toggleImageCrop }\n\t\t\t\t\t\t\thelp={ this.getImageCropHelp }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<SelectControl\n\t\t\t\t\t\t\tlabel={ __( 'Link To' ) }\n\t\t\t\t\t\t\tvalue={ linkTo }\n\t\t\t\t\t\t\tonChange={ this.setLinkTo }\n\t\t\t\t\t\t\toptions={ linkOptions }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</PanelBody>\n\t\t\t\t</InspectorControls>\n\t\t\t\t{ noticeUI }\n\t\t\t\t<figure className={ classnames(\n\t\t\t\t\tclassName,\n\t\t\t\t\t{\n\t\t\t\t\t\t[ `align${ align }` ]: align,\n\t\t\t\t\t\t[ `columns-${ columns }` ]: columns,\n\t\t\t\t\t\t'is-cropped': imageCrop,\n\t\t\t\t\t}\n\t\t\t\t) }\n\t\t\t\t>\n\t\t\t\t\t<ul className=\"blocks-gallery-grid\">\n\t\t\t\t\t\t{ images.map( ( img, index ) => {\n\t\t\t\t\t\t/* translators: %1$d is the order number of the image, %2$d is the total number of images. */\n\t\t\t\t\t\t\tconst ariaLabel = sprintf( __( 'image %1$d of %2$d in gallery' ), ( index + 1 ), images.length );\n\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<li className=\"blocks-gallery-item\" key={ img.id || img.url }>\n\t\t\t\t\t\t\t\t\t<GalleryImage\n\t\t\t\t\t\t\t\t\t\turl={ img.url }\n\t\t\t\t\t\t\t\t\t\talt={ img.alt }\n\t\t\t\t\t\t\t\t\t\tid={ img.id }\n\t\t\t\t\t\t\t\t\t\tisFirstItem={ index === 0 }\n\t\t\t\t\t\t\t\t\t\tisLastItem={ ( index + 1 ) === images.length }\n\t\t\t\t\t\t\t\t\t\tisSelected={ isSelected && this.state.selectedImage === index }\n\t\t\t\t\t\t\t\t\t\tonMoveBackward={ this.onMoveBackward( index ) }\n\t\t\t\t\t\t\t\t\t\tonMoveForward={ this.onMoveForward( index ) }\n\t\t\t\t\t\t\t\t\t\tonRemove={ this.onRemoveImage( index ) }\n\t\t\t\t\t\t\t\t\t\tonSelect={ this.onSelectImage( index ) }\n\t\t\t\t\t\t\t\t\t\tsetAttributes={ ( attrs ) => this.setImageAttributes( index, attrs ) }\n\t\t\t\t\t\t\t\t\t\tcaption={ img.caption }\n\t\t\t\t\t\t\t\t\t\taria-label={ ariaLabel }\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} ) }\n\t\t\t\t\t</ul>\n\t\t\t\t\t{ mediaPlaceholder }\n\t\t\t\t\t<RichText\n\t\t\t\t\t\ttagName=\"figcaption\"\n\t\t\t\t\t\tclassName={ captionClassNames }\n\t\t\t\t\t\tplaceholder={ __( 'Write gallery captionâ€¦' ) }\n\t\t\t\t\t\tvalue={ caption }\n\t\t\t\t\t\tunstableOnFocus={ this.onFocusGalleryCaption }\n\t\t\t\t\t\tonChange={ ( value ) => setAttributes( { caption: value } ) }\n\t\t\t\t\t\tinlineToolbar\n\t\t\t\t\t/>\n\t\t\t\t</figure>\n\t\t\t</>\n\t\t);\n\t}\n}\nexport default compose( [\n\twithSelect( ( select ) => {\n\t\tconst { getSettings } = select( 'core/block-editor' );\n\t\tconst {\n\t\t\t__experimentalMediaUpload,\n\t\t} = getSettings();\n\n\t\treturn {\n\t\t\tmediaUpload: __experimentalMediaUpload,\n\t\t};\n\t} ),\n\twithNotices,\n] )( GalleryEdit );\n"]}