{"version":3,"sources":["@wordpress/block-editor/src/components/url-input/index.js"],"names":["throttle","classnames","scrollIntoView","__","sprintf","_n","Component","createRef","UP","DOWN","ENTER","TAB","Spinner","withSpokenMessages","Popover","withInstanceId","withSafeTimeout","compose","withSelect","stopEventPropagation","event","stopPropagation","URLInput","autocompleteRef","arguments","onChange","bind","onKeyDown","inputRef","updateSuggestions","suggestionNodes","state","suggestions","showSuggestions","selectedSuggestion","scrollingIntoView","current","onlyScrollIfNeeded","props","setTimeout","suggestionsRequest","index","ref","value","fetchLinkSuggestions","length","test","setState","loading","request","then","debouncedSpeak","catch","inputValue","target","keyCode","selectionStart","preventDefault","setSelectionRange","suggestion","previousIndex","nextIndex","selectLink","speak","url","focus","autoFocus","instanceId","className","id","isFullWidth","hasBorder","suggestionsListboxId","suggestionOptionIdPrefix","undefined","map","bindSuggestionNode","handleOnClick","title","disableSuggestions","select","getSettings","__experimentalFetchLinkSuggestions"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { throttle } from 'lodash';\nimport classnames from 'classnames';\nimport scrollIntoView from 'dom-scroll-into-view';\n\n/**\n * WordPress dependencies\n */\nimport { __, sprintf, _n } from '@wordpress/i18n';\nimport { Component, createRef } from '@wordpress/element';\nimport { UP, DOWN, ENTER, TAB } from '@wordpress/keycodes';\nimport { Spinner, withSpokenMessages, Popover } from '@wordpress/components';\nimport { withInstanceId, withSafeTimeout, compose } from '@wordpress/compose';\nimport { withSelect } from '@wordpress/data';\n\n// Since URLInput is rendered in the context of other inputs, but should be\n// considered a separate modal node, prevent keyboard events from propagating\n// as being considered from the input.\nconst stopEventPropagation = ( event ) => event.stopPropagation();\n\nclass URLInput extends Component {\n\tconstructor( { autocompleteRef } ) {\n\t\tsuper( ...arguments );\n\n\t\tthis.onChange = this.onChange.bind( this );\n\t\tthis.onKeyDown = this.onKeyDown.bind( this );\n\t\tthis.autocompleteRef = autocompleteRef || createRef();\n\t\tthis.inputRef = createRef();\n\t\tthis.updateSuggestions = throttle( this.updateSuggestions.bind( this ), 200 );\n\n\t\tthis.suggestionNodes = [];\n\n\t\tthis.state = {\n\t\t\tsuggestions: [],\n\t\t\tshowSuggestions: false,\n\t\t\tselectedSuggestion: null,\n\t\t};\n\t}\n\n\tcomponentDidUpdate() {\n\t\tconst { showSuggestions, selectedSuggestion } = this.state;\n\t\t// only have to worry about scrolling selected suggestion into view\n\t\t// when already expanded\n\t\tif ( showSuggestions && selectedSuggestion !== null && ! this.scrollingIntoView ) {\n\t\t\tthis.scrollingIntoView = true;\n\t\t\tscrollIntoView( this.suggestionNodes[ selectedSuggestion ], this.autocompleteRef.current, {\n\t\t\t\tonlyScrollIfNeeded: true,\n\t\t\t} );\n\n\t\t\tthis.props.setTimeout( () => {\n\t\t\t\tthis.scrollingIntoView = false;\n\t\t\t}, 100 );\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tdelete this.suggestionsRequest;\n\t}\n\n\tbindSuggestionNode( index ) {\n\t\treturn ( ref ) => {\n\t\t\tthis.suggestionNodes[ index ] = ref;\n\t\t};\n\t}\n\n\tupdateSuggestions( value ) {\n\t\tconst { fetchLinkSuggestions } = this.props;\n\t\tif ( ! fetchLinkSuggestions ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Show the suggestions after typing at least 2 characters\n\t\t// and also for URLs\n\t\tif ( value.length < 2 || /^https?:/.test( value ) ) {\n\t\t\tthis.setState( {\n\t\t\t\tshowSuggestions: false,\n\t\t\t\tselectedSuggestion: null,\n\t\t\t\tloading: false,\n\t\t\t} );\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setState( {\n\t\t\tshowSuggestions: true,\n\t\t\tselectedSuggestion: null,\n\t\t\tloading: true,\n\t\t} );\n\n\t\tconst request = fetchLinkSuggestions( value );\n\n\t\trequest.then( ( suggestions ) => {\n\t\t\t// A fetch Promise doesn't have an abort option. It's mimicked by\n\t\t\t// comparing the request reference in on the instance, which is\n\t\t\t// reset or deleted on subsequent requests or unmounting.\n\t\t\tif ( this.suggestionsRequest !== request ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.setState( {\n\t\t\t\tsuggestions,\n\t\t\t\tloading: false,\n\t\t\t} );\n\n\t\t\tif ( !! suggestions.length ) {\n\t\t\t\tthis.props.debouncedSpeak( sprintf( _n(\n\t\t\t\t\t'%d result found, use up and down arrow keys to navigate.',\n\t\t\t\t\t'%d results found, use up and down arrow keys to navigate.',\n\t\t\t\t\tsuggestions.length\n\t\t\t\t), suggestions.length ), 'assertive' );\n\t\t\t} else {\n\t\t\t\tthis.props.debouncedSpeak( __( 'No results.' ), 'assertive' );\n\t\t\t}\n\t\t} ).catch( () => {\n\t\t\tif ( this.suggestionsRequest === request ) {\n\t\t\t\tthis.setState( {\n\t\t\t\t\tloading: false,\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n\n\t\tthis.suggestionsRequest = request;\n\t}\n\n\tonChange( event ) {\n\t\tconst inputValue = event.target.value;\n\t\tthis.props.onChange( inputValue );\n\t\tthis.updateSuggestions( inputValue );\n\t}\n\n\tonKeyDown( event ) {\n\t\tconst { showSuggestions, selectedSuggestion, suggestions, loading } = this.state;\n\t\t// If the suggestions are not shown or loading, we shouldn't handle the arrow keys\n\t\t// We shouldn't preventDefault to allow block arrow keys navigation\n\t\tif ( ! showSuggestions || ! suggestions.length || loading ) {\n\t\t\t// In the Windows version of Firefox the up and down arrows don't move the caret\n\t\t\t// within an input field like they do for Mac Firefox/Chrome/Safari. This causes\n\t\t\t// a form of focus trapping that is disruptive to the user experience. This disruption\n\t\t\t// only happens if the caret is not in the first or last position in the text input.\n\t\t\t// See: https://github.com/WordPress/gutenberg/issues/5693#issuecomment-436684747\n\t\t\tswitch ( event.keyCode ) {\n\t\t\t\t// When UP is pressed, if the caret is at the start of the text, move it to the 0\n\t\t\t\t// position.\n\t\t\t\tcase UP: {\n\t\t\t\t\tif ( 0 !== event.target.selectionStart ) {\n\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t\t\t// Set the input caret to position 0\n\t\t\t\t\t\tevent.target.setSelectionRange( 0, 0 );\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t// When DOWN is pressed, if the caret is not at the end of the text, move it to the\n\t\t\t\t// last position.\n\t\t\t\tcase DOWN: {\n\t\t\t\t\tif ( this.props.value.length !== event.target.selectionStart ) {\n\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t\t\t// Set the input caret to the last position\n\t\t\t\t\t\tevent.target.setSelectionRange( this.props.value.length, this.props.value.length );\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst suggestion = this.state.suggestions[ this.state.selectedSuggestion ];\n\n\t\tswitch ( event.keyCode ) {\n\t\t\tcase UP: {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tevent.preventDefault();\n\t\t\t\tconst previousIndex = ! selectedSuggestion ? suggestions.length - 1 : selectedSuggestion - 1;\n\t\t\t\tthis.setState( {\n\t\t\t\t\tselectedSuggestion: previousIndex,\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase DOWN: {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tevent.preventDefault();\n\t\t\t\tconst nextIndex = selectedSuggestion === null || ( selectedSuggestion === suggestions.length - 1 ) ? 0 : selectedSuggestion + 1;\n\t\t\t\tthis.setState( {\n\t\t\t\t\tselectedSuggestion: nextIndex,\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase TAB: {\n\t\t\t\tif ( this.state.selectedSuggestion !== null ) {\n\t\t\t\t\tthis.selectLink( suggestion );\n\t\t\t\t\t// Announce a link has been selected when tabbing away from the input field.\n\t\t\t\t\tthis.props.speak( __( 'Link selected.' ) );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ENTER: {\n\t\t\t\tif ( this.state.selectedSuggestion !== null ) {\n\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\tthis.selectLink( suggestion );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tselectLink( suggestion ) {\n\t\tthis.props.onChange( suggestion.url, suggestion );\n\t\tthis.setState( {\n\t\t\tselectedSuggestion: null,\n\t\t\tshowSuggestions: false,\n\t\t} );\n\t}\n\n\thandleOnClick( suggestion ) {\n\t\tthis.selectLink( suggestion );\n\t\t// Move focus to the input field when a link suggestion is clicked.\n\t\tthis.inputRef.current.focus();\n\t}\n\n\tstatic getDerivedStateFromProps( { disableSuggestions }, { showSuggestions } ) {\n\t\treturn {\n\t\t\tshowSuggestions: disableSuggestions === true ? false : showSuggestions,\n\t\t};\n\t}\n\n\trender() {\n\t\tconst { value = '', autoFocus = true, instanceId, className, id, isFullWidth, hasBorder } = this.props;\n\t\tconst { showSuggestions, suggestions, selectedSuggestion, loading } = this.state;\n\n\t\tconst suggestionsListboxId = `block-editor-url-input-suggestions-${ instanceId }`;\n\t\tconst suggestionOptionIdPrefix = `block-editor-url-input-suggestion-${ instanceId }`;\n\n\t\t/* eslint-disable jsx-a11y/no-autofocus */\n\t\treturn (\n\t\t\t<div className={ classnames( 'editor-url-input block-editor-url-input', className, {\n\t\t\t\t'is-full-width': isFullWidth,\n\t\t\t\t'has-border': hasBorder,\n\t\t\t} ) }>\n\t\t\t\t<input\n\t\t\t\t\tid={ id }\n\t\t\t\t\tautoFocus={ autoFocus }\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\taria-label={ __( 'URL' ) }\n\t\t\t\t\trequired\n\t\t\t\t\tvalue={ value }\n\t\t\t\t\tonChange={ this.onChange }\n\t\t\t\t\tonInput={ stopEventPropagation }\n\t\t\t\t\tplaceholder={ __( 'Paste URL or type to search' ) }\n\t\t\t\t\tonKeyDown={ this.onKeyDown }\n\t\t\t\t\trole=\"combobox\"\n\t\t\t\t\taria-expanded={ showSuggestions }\n\t\t\t\t\taria-autocomplete=\"list\"\n\t\t\t\t\taria-owns={ suggestionsListboxId }\n\t\t\t\t\taria-activedescendant={ selectedSuggestion !== null ? `${ suggestionOptionIdPrefix }-${ selectedSuggestion }` : undefined }\n\t\t\t\t\tref={ this.inputRef }\n\t\t\t\t/>\n\n\t\t\t\t{ ( loading ) && <Spinner /> }\n\n\t\t\t\t{ showSuggestions && !! suggestions.length &&\n\t\t\t\t\t<Popover\n\t\t\t\t\t\tposition=\"bottom\"\n\t\t\t\t\t\tnoArrow\n\t\t\t\t\t\tfocusOnMount={ false }\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={ classnames(\n\t\t\t\t\t\t\t\t'editor-url-input__suggestions',\n\t\t\t\t\t\t\t\t'block-editor-url-input__suggestions',\n\t\t\t\t\t\t\t\t`${ className }__suggestions`\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\tid={ suggestionsListboxId }\n\t\t\t\t\t\t\tref={ this.autocompleteRef }\n\t\t\t\t\t\t\trole=\"listbox\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ suggestions.map( ( suggestion, index ) => (\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tkey={ suggestion.id }\n\t\t\t\t\t\t\t\t\trole=\"option\"\n\t\t\t\t\t\t\t\t\ttabIndex=\"-1\"\n\t\t\t\t\t\t\t\t\tid={ `${ suggestionOptionIdPrefix }-${ index }` }\n\t\t\t\t\t\t\t\t\tref={ this.bindSuggestionNode( index ) }\n\t\t\t\t\t\t\t\t\tclassName={ classnames( 'editor-url-input__suggestion block-editor-url-input__suggestion', {\n\t\t\t\t\t\t\t\t\t\t'is-selected': index === selectedSuggestion,\n\t\t\t\t\t\t\t\t\t} ) }\n\t\t\t\t\t\t\t\t\tonClick={ () => this.handleOnClick( suggestion ) }\n\t\t\t\t\t\t\t\t\taria-selected={ index === selectedSuggestion }\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{ suggestion.title }\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t) ) }\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</Popover>\n\t\t\t\t}\n\t\t\t</div>\n\t\t);\n\t\t/* eslint-enable jsx-a11y/no-autofocus */\n\t}\n}\n\n/**\n * @see https://github.com/WordPress/gutenberg/blob/master/packages/block-editor/src/components/url-input/README.md\n */\nexport default compose(\n\twithSafeTimeout,\n\twithSpokenMessages,\n\twithInstanceId,\n\twithSelect( ( select ) => {\n\t\tconst { getSettings } = select( 'core/block-editor' );\n\t\treturn {\n\t\t\tfetchLinkSuggestions: getSettings().__experimentalFetchLinkSuggestions,\n\t\t};\n\t} )\n)( URLInput );\n"]}