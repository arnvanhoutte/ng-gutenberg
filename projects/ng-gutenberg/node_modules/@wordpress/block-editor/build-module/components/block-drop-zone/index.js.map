{"version":3,"sources":["@wordpress/block-editor/src/components/block-drop-zone/index.js"],"names":["classnames","DropZone","withFilters","pasteHandler","getBlockTransforms","findTransform","Component","withDispatch","withSelect","compose","MediaUploadCheck","parseDropEvent","event","result","srcRootClientId","srcClientId","srcIndex","type","dataTransfer","Object","assign","JSON","parse","getData","err","BlockDropZone","arguments","onFilesDrop","bind","onHTMLDrop","onDrop","position","props","clientId","rootClientId","getBlockIndex","undefined","index","y","files","transformation","transform","isMatch","insertIndex","getInsertIndex","blocks","updateBlockAttributes","insertBlocks","HTML","mode","length","dstRootClientId","dstClientId","getClientIdsOfDescendants","isBlockDropType","dropType","isSameLevel","srcRoot","dstRoot","isSameBlock","src","dst","isSrcBlockAnAncestorOfDstBlock","some","id","dstIndex","positionIndex","moveBlockToPosition","isLockedAll","isAppender","dispatch","ownProps","select","getTemplateLock"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tDropZone,\n\twithFilters,\n} from '@wordpress/components';\nimport {\n\tpasteHandler,\n\tgetBlockTransforms,\n\tfindTransform,\n} from '@wordpress/blocks';\nimport { Component } from '@wordpress/element';\nimport { withDispatch, withSelect } from '@wordpress/data';\nimport { compose } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport MediaUploadCheck from '../media-upload/check';\n\nconst parseDropEvent = ( event ) => {\n\tlet result = {\n\t\tsrcRootClientId: null,\n\t\tsrcClientId: null,\n\t\tsrcIndex: null,\n\t\ttype: null,\n\t};\n\n\tif ( ! event.dataTransfer ) {\n\t\treturn result;\n\t}\n\n\ttry {\n\t\tresult = Object.assign( result, JSON.parse( event.dataTransfer.getData( 'text' ) ) );\n\t} catch ( err ) {\n\t\treturn result;\n\t}\n\n\treturn result;\n};\n\nclass BlockDropZone extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.onFilesDrop = this.onFilesDrop.bind( this );\n\t\tthis.onHTMLDrop = this.onHTMLDrop.bind( this );\n\t\tthis.onDrop = this.onDrop.bind( this );\n\t}\n\n\tgetInsertIndex( position ) {\n\t\tconst { clientId, rootClientId, getBlockIndex } = this.props;\n\t\tif ( clientId !== undefined ) {\n\t\t\tconst index = getBlockIndex( clientId, rootClientId );\n\t\t\treturn ( position && position.y === 'top' ) ? index : index + 1;\n\t\t}\n\t}\n\n\tonFilesDrop( files, position ) {\n\t\tconst transformation = findTransform(\n\t\t\tgetBlockTransforms( 'from' ),\n\t\t\t( transform ) => transform.type === 'files' && transform.isMatch( files )\n\t\t);\n\n\t\tif ( transformation ) {\n\t\t\tconst insertIndex = this.getInsertIndex( position );\n\t\t\tconst blocks = transformation.transform( files, this.props.updateBlockAttributes );\n\t\t\tthis.props.insertBlocks( blocks, insertIndex );\n\t\t}\n\t}\n\n\tonHTMLDrop( HTML, position ) {\n\t\tconst blocks = pasteHandler( { HTML, mode: 'BLOCKS' } );\n\n\t\tif ( blocks.length ) {\n\t\t\tthis.props.insertBlocks( blocks, this.getInsertIndex( position ) );\n\t\t}\n\t}\n\n\tonDrop( event, position ) {\n\t\tconst { rootClientId: dstRootClientId, clientId: dstClientId, getClientIdsOfDescendants, getBlockIndex } = this.props;\n\t\tconst { srcRootClientId, srcClientId, srcIndex, type } = parseDropEvent( event );\n\n\t\tconst isBlockDropType = ( dropType ) => dropType === 'block';\n\t\tconst isSameLevel = ( srcRoot, dstRoot ) => {\n\t\t\t// Note that rootClientId of top-level blocks will be undefined OR a void string,\n\t\t\t// so we also need to account for that case separately.\n\t\t\treturn ( srcRoot === dstRoot ) || ( ! srcRoot === true && ! dstRoot === true );\n\t\t};\n\t\tconst isSameBlock = ( src, dst ) => src === dst;\n\t\tconst isSrcBlockAnAncestorOfDstBlock = ( src, dst ) => getClientIdsOfDescendants( [ src ] ).some( ( id ) => id === dst );\n\n\t\tif ( ! isBlockDropType( type ) ||\n\t\t\tisSameBlock( srcClientId, dstClientId ) ||\n\t\t\tisSrcBlockAnAncestorOfDstBlock( srcClientId, dstClientId || dstRootClientId ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst dstIndex = dstClientId ? getBlockIndex( dstClientId, dstRootClientId ) : undefined;\n\t\tconst positionIndex = this.getInsertIndex( position );\n\t\t// If the block is kept at the same level and moved downwards,\n\t\t// subtract to account for blocks shifting upward to occupy its old position.\n\t\tconst insertIndex = dstIndex && srcIndex < dstIndex && isSameLevel( srcRootClientId, dstRootClientId ) ? positionIndex - 1 : positionIndex;\n\t\tthis.props.moveBlockToPosition( srcClientId, srcRootClientId, insertIndex );\n\t}\n\n\trender() {\n\t\tconst { isLockedAll } = this.props;\n\t\tif ( isLockedAll ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst index = this.getInsertIndex();\n\t\tconst isAppender = index === undefined;\n\n\t\treturn (\n\t\t\t<MediaUploadCheck>\n\t\t\t\t<DropZone\n\t\t\t\t\tclassName={ classnames( 'editor-block-drop-zone block-editor-block-drop-zone', {\n\t\t\t\t\t\t'is-appender': isAppender,\n\t\t\t\t\t} ) }\n\t\t\t\t\tonFilesDrop={ this.onFilesDrop }\n\t\t\t\t\tonHTMLDrop={ this.onHTMLDrop }\n\t\t\t\t\tonDrop={ this.onDrop }\n\t\t\t\t/>\n\t\t\t</MediaUploadCheck>\n\t\t);\n\t}\n}\n\nexport default compose(\n\twithDispatch( ( dispatch, ownProps ) => {\n\t\tconst {\n\t\t\tinsertBlocks,\n\t\t\tupdateBlockAttributes,\n\t\t\tmoveBlockToPosition,\n\t\t} = dispatch( 'core/block-editor' );\n\n\t\treturn {\n\t\t\tinsertBlocks( blocks, index ) {\n\t\t\t\tconst { rootClientId } = ownProps;\n\n\t\t\t\tinsertBlocks( blocks, index, rootClientId );\n\t\t\t},\n\t\t\tupdateBlockAttributes( ...args ) {\n\t\t\t\tupdateBlockAttributes( ...args );\n\t\t\t},\n\t\t\tmoveBlockToPosition( srcClientId, srcRootClientId, dstIndex ) {\n\t\t\t\tconst { rootClientId: dstRootClientId } = ownProps;\n\t\t\t\tmoveBlockToPosition( srcClientId, srcRootClientId, dstRootClientId, dstIndex );\n\t\t\t},\n\t\t};\n\t} ),\n\twithSelect( ( select, { rootClientId } ) => {\n\t\tconst { getClientIdsOfDescendants, getTemplateLock, getBlockIndex } = select( 'core/block-editor' );\n\t\treturn {\n\t\t\tisLockedAll: getTemplateLock( rootClientId ) === 'all',\n\t\t\tgetClientIdsOfDescendants,\n\t\t\tgetBlockIndex,\n\t\t};\n\t} ),\n\twithFilters( 'editor.BlockDropZone' )\n)( BlockDropZone );\n"]}