{"version":3,"sources":["@wordpress/core-data/src/controls.js"],"names":["apiFetch","request","type","select","selectorName","args","resolveSelect","controls","API_FETCH","SELECT","registry","RESOLVE_SELECT","Promise","resolve","hasFinished","hasFinishedResolution","getResult","apply","result","unsubscribe","subscribe"],"mappings":";;;;;;;;;;;;;;AAGA;;AACA;;AAJA;;;;AAMA;;;;;;AAMO,SAASA,QAAT,CAAmBC,OAAnB,EAA6B;AACnC,SAAO;AACNC,IAAAA,IAAI,EAAE,WADA;AAEND,IAAAA,OAAO,EAAPA;AAFM,GAAP;AAIA;AAED;;;;;;;;;;AAQO,SAASE,MAAT,CAAiBC,YAAjB,EAAyC;AAAA,oCAAPC,IAAO;AAAPA,IAAAA,IAAO;AAAA;;AAC/C,SAAO;AACNH,IAAAA,IAAI,EAAE,QADA;AAENE,IAAAA,YAAY,EAAZA,YAFM;AAGNC,IAAAA,IAAI,EAAJA;AAHM,GAAP;AAKA;AAED;;;;;;;;;;;AASO,SAASC,aAAT,CAAwBF,YAAxB,EAAgD;AAAA,qCAAPC,IAAO;AAAPA,IAAAA,IAAO;AAAA;;AACtD,SAAO;AACNH,IAAAA,IAAI,EAAE,gBADA;AAENE,IAAAA,YAAY,EAAZA,YAFM;AAGNC,IAAAA,IAAI,EAAJA;AAHM,GAAP;AAKA;;AAED,IAAME,QAAQ,GAAG;AAChBC,EAAAA,SADgB,2BACS;AAAA,QAAZP,OAAY,QAAZA,OAAY;AACxB,WAAO,uBAAiBA,OAAjB,CAAP;AACA,GAHe;AAKhBQ,EAAAA,MAAM,EAAE,iCAAuB,UAAEC,QAAF;AAAA,WAAgB,iBAA8B;AAAA;;AAAA,UAA1BN,YAA0B,SAA1BA,YAA0B;AAAA,UAAZC,IAAY,SAAZA,IAAY;AAC5E,aAAO,oBAAAK,QAAQ,CAACP,MAAT,CAAiB,MAAjB,GAA2BC,YAA3B,2DAA8CC,IAA9C,EAAP;AACA,KAF8B;AAAA,GAAvB,CALQ;AAShBM,EAAAA,cAAc,EAAE,iCACf,UAAED,QAAF;AAAA,WAAgB,iBAA8B;AAAA,UAA1BN,YAA0B,SAA1BA,YAA0B;AAAA,UAAZC,IAAY,SAAZA,IAAY;AAC7C,aAAO,IAAIO,OAAJ,CAAa,UAAEC,OAAF,EAAe;AAClC,YAAMC,WAAW,GAAG,SAAdA,WAAc;AAAA,iBAAMJ,QAAQ,CAACP,MAAT,CAAiB,WAAjB,EACxBY,qBADwB,CACD,MADC,EACOX,YADP,EACqBC,IADrB,CAAN;AAAA,SAApB;;AAEA,YAAMW,SAAS,GAAG,SAAZA,SAAY;AAAA,iBAAMN,QAAQ,CAACP,MAAT,CAAiB,MAAjB,EAA2BC,YAA3B,EACtBa,KADsB,CACf,IADe,EACTZ,IADS,CAAN;AAAA,SAAlB,CAHkC,CAMlC;;;AACA,YAAMa,MAAM,GAAGF,SAAS,EAAxB;;AACA,YAAKF,WAAW,EAAhB,EAAqB;AACpB,iBAAOD,OAAO,CAAEK,MAAF,CAAd;AACA;;AAED,YAAMC,WAAW,GAAGT,QAAQ,CAACU,SAAT,CAAoB,YAAM;AAC7C,cAAKN,WAAW,EAAhB,EAAqB;AACpBK,YAAAA,WAAW;AACXN,YAAAA,OAAO,CAAEG,SAAS,EAAX,CAAP;AACA;AACD,SALmB,CAApB;AAMA,OAlBM,CAAP;AAmBA,KApBD;AAAA,GADe;AATA,CAAjB;eAkCeT,Q","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { default as triggerApiFetch } from '@wordpress/api-fetch';\nimport { createRegistryControl } from '@wordpress/data';\n\n/**\n * Trigger an API Fetch request.\n *\n * @param {Object} request API Fetch Request Object.\n * @return {Object} control descriptor.\n */\nexport function apiFetch( request ) {\n\treturn {\n\t\ttype: 'API_FETCH',\n\t\trequest,\n\t};\n}\n\n/**\n * Calls a selector using the current state.\n *\n * @param {string} selectorName Selector name.\n * @param  {Array} args         Selector arguments.\n *\n * @return {Object} control descriptor.\n */\nexport function select( selectorName, ...args ) {\n\treturn {\n\t\ttype: 'SELECT',\n\t\tselectorName,\n\t\targs,\n\t};\n}\n\n/**\n * Dispatches a control action for triggering a registry select that has a\n * resolver.\n *\n * @param {string}  selectorName\n * @param {Array}   args  Arguments for the select.\n *\n * @return {Object} control descriptor.\n */\nexport function resolveSelect( selectorName, ...args ) {\n\treturn {\n\t\ttype: 'RESOLVE_SELECT',\n\t\tselectorName,\n\t\targs,\n\t};\n}\n\nconst controls = {\n\tAPI_FETCH( { request } ) {\n\t\treturn triggerApiFetch( request );\n\t},\n\n\tSELECT: createRegistryControl( ( registry ) => ( { selectorName, args } ) => {\n\t\treturn registry.select( 'core' )[ selectorName ]( ...args );\n\t} ),\n\n\tRESOLVE_SELECT: createRegistryControl(\n\t\t( registry ) => ( { selectorName, args } ) => {\n\t\t\treturn new Promise( ( resolve ) => {\n\t\t\t\tconst hasFinished = () => registry.select( 'core/data' )\n\t\t\t\t\t.hasFinishedResolution( 'core', selectorName, args );\n\t\t\t\tconst getResult = () => registry.select( 'core' )[ selectorName ]\n\t\t\t\t\t.apply( null, args );\n\n\t\t\t\t// trigger the selector (to trigger the resolver)\n\t\t\t\tconst result = getResult();\n\t\t\t\tif ( hasFinished() ) {\n\t\t\t\t\treturn resolve( result );\n\t\t\t\t}\n\n\t\t\t\tconst unsubscribe = registry.subscribe( () => {\n\t\t\t\t\tif ( hasFinished() ) {\n\t\t\t\t\t\tunsubscribe();\n\t\t\t\t\t\tresolve( getResult() );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} );\n\t\t}\n\t),\n};\n\nexport default controls;\n"]}