{"version":3,"sources":["@wordpress/core-data/src/reducer.js"],"names":["keyBy","map","groupBy","flowRight","isEqual","get","combineReducers","isShallowEqual","ifMatchingAction","replaceAction","reducer","queriedDataReducer","defaultEntities","DEFAULT_ENTITY_KEY","terms","state","action","type","taxonomy","users","byId","queries","queryID","user","id","currentUser","taxonomies","themeSupports","entity","entityConfig","name","kind","key","queriedData","edits","nextState","record","recordId","nextEdits","Object","keys","reduce","acc","length","items","forEach","undefined","saving","pending","error","isAutosave","entitiesConfig","entities","newConfig","config","entitiesDataReducer","entitiesByKind","entries","memo","subEntities","kindReducer","kindMemo","newData","data","UNDO_INITIAL_STATE","offset","lastEditAction","undo","isCreateUndoLevel","isUndoOrRedo","meta","isUndo","isRedo","flattenedUndo","some","transientEdits","slice","pop","push","comparisonUndoEdits","values","filter","edit","comparisonEdits","embedPreviews","url","preview","userPermissions","isAllowed","autosaves","postId","autosavesData"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { keyBy, map, groupBy, flowRight, isEqual, get } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { combineReducers } from '@wordpress/data';\nimport isShallowEqual from '@wordpress/is-shallow-equal';\n\n/**\n * Internal dependencies\n */\nimport { ifMatchingAction, replaceAction } from './utils';\nimport { reducer as queriedDataReducer } from './queried-data';\nimport { defaultEntities, DEFAULT_ENTITY_KEY } from './entities';\n\n/**\n * Reducer managing terms state. Keyed by taxonomy slug, the value is either\n * undefined (if no request has been made for given taxonomy), null (if a\n * request is in-flight for given taxonomy), or the array of terms for the\n * taxonomy.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function terms( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_TERMS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ action.taxonomy ]: action.terms,\n\t\t\t};\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer managing authors state. Keyed by id.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function users( state = { byId: {}, queries: {} }, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_USER_QUERY':\n\t\t\treturn {\n\t\t\t\tbyId: {\n\t\t\t\t\t...state.byId,\n\t\t\t\t\t...keyBy( action.users, 'id' ),\n\t\t\t\t},\n\t\t\t\tqueries: {\n\t\t\t\t\t...state.queries,\n\t\t\t\t\t[ action.queryID ]: map( action.users, ( user ) => user.id ),\n\t\t\t\t},\n\t\t\t};\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer managing current user state.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function currentUser( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_CURRENT_USER':\n\t\t\treturn action.currentUser;\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer managing taxonomies.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function taxonomies( state = [], action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_TAXONOMIES':\n\t\t\treturn action.taxonomies;\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer managing theme supports data.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function themeSupports( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_THEME_SUPPORTS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t...action.themeSupports,\n\t\t\t};\n\t}\n\n\treturn state;\n}\n\n/**\n * Higher Order Reducer for a given entity config. It supports:\n *\n *  - Fetching\n *  - Editing\n *  - Saving\n *\n * @param {Object} entityConfig  Entity config.\n *\n * @return {Function} Reducer.\n */\nfunction entity( entityConfig ) {\n\treturn flowRight( [\n\t\t// Limit to matching action type so we don't attempt to replace action on\n\t\t// an unhandled action.\n\t\tifMatchingAction( ( action ) => (\n\t\t\taction.name &&\n\t\t\taction.kind &&\n\t\t\taction.name === entityConfig.name &&\n\t\t\taction.kind === entityConfig.kind\n\t\t) ),\n\n\t\t// Inject the entity config into the action.\n\t\treplaceAction( ( action ) => {\n\t\t\treturn {\n\t\t\t\t...action,\n\t\t\t\tkey: entityConfig.key || DEFAULT_ENTITY_KEY,\n\t\t\t};\n\t\t} ),\n\t] )(\n\t\tcombineReducers( {\n\t\t\tqueriedData: queriedDataReducer,\n\n\t\t\tedits: ( state = {}, action ) => {\n\t\t\t\tswitch ( action.type ) {\n\t\t\t\t\tcase 'RECEIVE_ITEMS':\n\t\t\t\t\t\tconst nextState = { ...state };\n\n\t\t\t\t\t\tfor ( const record of action.items ) {\n\t\t\t\t\t\t\tconst recordId = record[ action.key ];\n\t\t\t\t\t\t\tconst edits = nextState[ recordId ];\n\t\t\t\t\t\t\tif ( ! edits ) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst nextEdits = Object.keys( edits ).reduce( ( acc, key ) => {\n\t\t\t\t\t\t\t\t// If the edited value is still different to the persisted value,\n\t\t\t\t\t\t\t\t// keep the edited value in edits.\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t// Edits are the \"raw\" attribute values, but records may have\n\t\t\t\t\t\t\t\t\t// objects with more properties, so we use `get` here for the\n\t\t\t\t\t\t\t\t\t// comparison.\n\t\t\t\t\t\t\t\t\t! isEqual( edits[ key ], get( record[ key ], 'raw', record[ key ] ) )\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\tacc[ key ] = edits[ key ];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn acc;\n\t\t\t\t\t\t\t}, {} );\n\n\t\t\t\t\t\t\tif ( Object.keys( nextEdits ).length ) {\n\t\t\t\t\t\t\t\tnextState[ recordId ] = nextEdits;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdelete nextState[ recordId ];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn nextState;\n\n\t\t\t\t\tcase 'EDIT_ENTITY_RECORD':\n\t\t\t\t\t\tconst nextEdits = {\n\t\t\t\t\t\t\t...state[ action.recordId ],\n\t\t\t\t\t\t\t...action.edits,\n\t\t\t\t\t\t};\n\t\t\t\t\t\tObject.keys( nextEdits ).forEach( ( key ) => {\n\t\t\t\t\t\t\t// Delete cleared edits so that the properties\n\t\t\t\t\t\t\t// are not considered dirty.\n\t\t\t\t\t\t\tif ( nextEdits[ key ] === undefined ) {\n\t\t\t\t\t\t\t\tdelete nextEdits[ key ];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} );\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...state,\n\t\t\t\t\t\t\t[ action.recordId ]: nextEdits,\n\t\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn state;\n\t\t\t},\n\n\t\t\tsaving: ( state = {}, action ) => {\n\t\t\t\tswitch ( action.type ) {\n\t\t\t\t\tcase 'SAVE_ENTITY_RECORD_START':\n\t\t\t\t\tcase 'SAVE_ENTITY_RECORD_FINISH':\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...state,\n\t\t\t\t\t\t\t[ action.recordId ]: {\n\t\t\t\t\t\t\t\tpending: action.type === 'SAVE_ENTITY_RECORD_START',\n\t\t\t\t\t\t\t\terror: action.error,\n\t\t\t\t\t\t\t\tisAutosave: action.isAutosave,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn state;\n\t\t\t},\n\t\t} )\n\t);\n}\n\n/**\n * Reducer keeping track of the registered entities.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function entitiesConfig( state = defaultEntities, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'ADD_ENTITIES':\n\t\t\treturn [\n\t\t\t\t...state,\n\t\t\t\t...action.entities,\n\t\t\t];\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer keeping track of the registered entities config and data.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport const entities = ( state = {}, action ) => {\n\tconst newConfig = entitiesConfig( state.config, action );\n\n\t// Generates a dynamic reducer for the entities\n\tlet entitiesDataReducer = state.reducer;\n\tif ( ! entitiesDataReducer || newConfig !== state.config ) {\n\t\tconst entitiesByKind = groupBy( newConfig, 'kind' );\n\t\tentitiesDataReducer = combineReducers( Object.entries( entitiesByKind ).reduce( ( memo, [ kind, subEntities ] ) => {\n\t\t\tconst kindReducer = combineReducers( subEntities.reduce(\n\t\t\t\t( kindMemo, entityConfig ) => ( {\n\t\t\t\t\t...kindMemo,\n\t\t\t\t\t[ entityConfig.name ]: entity( entityConfig ),\n\t\t\t\t} ),\n\t\t\t\t{}\n\t\t\t) );\n\n\t\t\tmemo[ kind ] = kindReducer;\n\t\t\treturn memo;\n\t\t}, {} ) );\n\t}\n\n\tconst newData = entitiesDataReducer( state.data, action );\n\n\tif (\n\t\tnewData === state.data &&\n\t\tnewConfig === state.config &&\n\t\tentitiesDataReducer === state.reducer\n\t) {\n\t\treturn state;\n\t}\n\n\treturn {\n\t\treducer: entitiesDataReducer,\n\t\tdata: newData,\n\t\tconfig: newConfig,\n\t};\n};\n\n/**\n * Reducer keeping track of entity edit undo history.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nconst UNDO_INITIAL_STATE = [];\nUNDO_INITIAL_STATE.offset = 0;\nlet lastEditAction;\nexport function undo( state = UNDO_INITIAL_STATE, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'EDIT_ENTITY_RECORD':\n\t\tcase 'CREATE_UNDO_LEVEL':\n\t\t\tlet isCreateUndoLevel = action.type === 'CREATE_UNDO_LEVEL';\n\t\t\tconst isUndoOrRedo =\n\t\t\t\t! isCreateUndoLevel && ( action.meta.isUndo || action.meta.isRedo );\n\t\t\tif ( isCreateUndoLevel ) {\n\t\t\t\taction = lastEditAction;\n\t\t\t} else if ( ! isUndoOrRedo ) {\n\t\t\t\tlastEditAction = action;\n\t\t\t}\n\n\t\t\tlet nextState;\n\t\t\tif ( isUndoOrRedo ) {\n\t\t\t\tnextState = [ ...state ];\n\t\t\t\tnextState.offset = state.offset + ( action.meta.isUndo ? -1 : 1 );\n\n\t\t\t\tif ( state.flattenedUndo ) {\n\t\t\t\t\t// The first undo in a sequence of undos might happen while we have\n\t\t\t\t\t// flattened undos in state. If this is the case, we want execution\n\t\t\t\t\t// to continue as if we were creating an explicit undo level. This\n\t\t\t\t\t// will result in an extra undo level being appended with the flattened\n\t\t\t\t\t// undo values.\n\t\t\t\t\tisCreateUndoLevel = true;\n\t\t\t\t\taction = lastEditAction;\n\t\t\t\t} else {\n\t\t\t\t\treturn nextState;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( ! action.meta.undo ) {\n\t\t\t\treturn state;\n\t\t\t}\n\n\t\t\t// Transient edits don't create an undo level, but are\n\t\t\t// reachable in the next meaningful edit to which they\n\t\t\t// are merged. They are defined in the entity's config.\n\t\t\tif (\n\t\t\t\t! isCreateUndoLevel &&\n\t\t\t\t! Object.keys( action.edits ).some( ( key ) => ! action.transientEdits[ key ] )\n\t\t\t) {\n\t\t\t\tnextState = [ ...state ];\n\t\t\t\tnextState.flattenedUndo = { ...state.flattenedUndo, ...action.edits };\n\t\t\t\tnextState.offset = state.offset;\n\t\t\t\treturn nextState;\n\t\t\t}\n\n\t\t\t// Clear potential redos, because this only supports linear history.\n\t\t\tnextState = nextState || state.slice( 0, state.offset || undefined );\n\t\t\tnextState.offset = nextState.offset || 0;\n\t\t\tnextState.pop();\n\t\t\tif ( ! isCreateUndoLevel ) {\n\t\t\t\tnextState.push( {\n\t\t\t\t\tkind: action.meta.undo.kind,\n\t\t\t\t\tname: action.meta.undo.name,\n\t\t\t\t\trecordId: action.meta.undo.recordId,\n\t\t\t\t\tedits: { ...state.flattenedUndo, ...action.meta.undo.edits },\n\t\t\t\t} );\n\t\t\t}\n\t\t\t// When an edit is a function it's an optimization to avoid running some expensive operation.\n\t\t\t// We can't rely on the function references being the same so we opt out of comparing them here.\n\t\t\tconst comparisonUndoEdits = Object.values( action.meta.undo.edits ).filter(\n\t\t\t\t( edit ) => typeof edit !== 'function'\n\t\t\t);\n\t\t\tconst comparisonEdits = Object.values( action.edits ).filter(\n\t\t\t\t( edit ) => typeof edit !== 'function'\n\t\t\t);\n\t\t\tif ( ! isShallowEqual( comparisonUndoEdits, comparisonEdits ) ) {\n\t\t\t\tnextState.push( {\n\t\t\t\t\tkind: action.kind,\n\t\t\t\t\tname: action.name,\n\t\t\t\t\trecordId: action.recordId,\n\t\t\t\t\tedits: isCreateUndoLevel ?\n\t\t\t\t\t\t{ ...state.flattenedUndo, ...action.edits } :\n\t\t\t\t\t\taction.edits,\n\t\t\t\t} );\n\t\t\t}\n\t\t\treturn nextState;\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer managing embed preview data.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function embedPreviews( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_EMBED_PREVIEW':\n\t\t\tconst { url, preview } = action;\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ url ]: preview,\n\t\t\t};\n\t}\n\treturn state;\n}\n\n/**\n * State which tracks whether the user can perform an action on a REST\n * resource.\n *\n * @param  {Object} state  Current state.\n * @param  {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function userPermissions( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_USER_PERMISSION':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ action.key ]: action.isAllowed,\n\t\t\t};\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer returning autosaves keyed by their parent's post id.\n *\n * @param  {Object} state  Current state.\n * @param  {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function autosaves( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_AUTOSAVES':\n\t\t\tconst { postId, autosaves: autosavesData } = action;\n\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ postId ]: autosavesData,\n\t\t\t};\n\t}\n\n\treturn state;\n}\n\nexport default combineReducers( {\n\tterms,\n\tusers,\n\tcurrentUser,\n\ttaxonomies,\n\tthemeSupports,\n\tentities,\n\tundo,\n\tembedPreviews,\n\tuserPermissions,\n\tautosaves,\n} );\n"]}