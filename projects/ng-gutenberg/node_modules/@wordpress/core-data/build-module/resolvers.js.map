{"version":3,"sources":["@wordpress/core-data/src/resolvers.js"],"names":["getAuthors","getCurrentUser","getEntityRecord","getEntityRecords","getThemeSupports","getEmbedPreview","hasUploadPermissions","canUser","getAutosaves","getAutosave","find","includes","get","hasIn","compact","addQueryArgs","deprecated","receiveUserQuery","receiveCurrentUser","receiveEntityRecords","receiveThemeSupports","receiveEmbedPreview","receiveUserPermission","receiveAutosaves","getKindEntities","apiFetch","resolveSelect","path","users","currentUser","kind","name","key","entities","entity","baseURL","record","query","context","records","Object","values","shouldInvalidate","action","type","invalidateCache","activeThemes","theme_supports","url","embedProxyResponse","alternative","resource","id","methods","create","read","update","delete","method","Error","parse","response","allowHeader","headers","join","isAllowed","postType","postId","restBase","rest_base","autosaves","length"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { find, includes, get, hasIn, compact } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { addQueryArgs } from '@wordpress/url';\nimport deprecated from '@wordpress/deprecated';\n\n/**\n * Internal dependencies\n */\nimport {\n\treceiveUserQuery,\n\treceiveCurrentUser,\n\treceiveEntityRecords,\n\treceiveThemeSupports,\n\treceiveEmbedPreview,\n\treceiveUserPermission,\n\treceiveAutosaves,\n} from './actions';\nimport { getKindEntities } from './entities';\nimport { apiFetch, resolveSelect } from './controls';\n\n/**\n * Requests authors from the REST API.\n */\nexport function* getAuthors() {\n\tconst users = yield apiFetch( { path: '/wp/v2/users/?who=authors&per_page=-1' } );\n\tyield receiveUserQuery( 'authors', users );\n}\n\n/**\n * Requests the current user from the REST API.\n */\nexport function* getCurrentUser() {\n\tconst currentUser = yield apiFetch( { path: '/wp/v2/users/me' } );\n\tyield receiveCurrentUser( currentUser );\n}\n\n/**\n * Requests an entity's record from the REST API.\n *\n * @param {string} kind   Entity kind.\n * @param {string} name   Entity name.\n * @param {number} key    Record's key\n */\nexport function* getEntityRecord( kind, name, key ) {\n\tconst entities = yield getKindEntities( kind );\n\tconst entity = find( entities, { kind, name } );\n\tif ( ! entity ) {\n\t\treturn;\n\t}\n\tconst record = yield apiFetch( { path: `${ entity.baseURL }/${ key }?context=edit` } );\n\tyield receiveEntityRecords( kind, name, record );\n}\n\n/**\n * Requests the entity's records from the REST API.\n *\n * @param {string}  kind   Entity kind.\n * @param {string}  name   Entity name.\n * @param {Object?} query  Query Object.\n */\nexport function* getEntityRecords( kind, name, query = {} ) {\n\tconst entities = yield getKindEntities( kind );\n\tconst entity = find( entities, { kind, name } );\n\tif ( ! entity ) {\n\t\treturn;\n\t}\n\tconst path = addQueryArgs( entity.baseURL, {\n\t\t...query,\n\t\tcontext: 'edit',\n\t} );\n\tconst records = yield apiFetch( { path } );\n\tyield receiveEntityRecords( kind, name, Object.values( records ), query );\n}\n\ngetEntityRecords.shouldInvalidate = ( action, kind, name ) => {\n\treturn (\n\t\taction.type === 'RECEIVE_ITEMS' &&\n\t\taction.invalidateCache &&\n\t\tkind === action.kind &&\n\t\tname === action.name\n\t);\n};\n\n/**\n * Requests theme supports data from the index.\n */\nexport function* getThemeSupports() {\n\tconst activeThemes = yield apiFetch( { path: '/wp/v2/themes?status=active' } );\n\tyield receiveThemeSupports( activeThemes[ 0 ].theme_supports );\n}\n\n/**\n * Requests a preview from the from the Embed API.\n *\n * @param {string} url   URL to get the preview for.\n */\nexport function* getEmbedPreview( url ) {\n\ttry {\n\t\tconst embedProxyResponse = yield apiFetch( { path: addQueryArgs( '/oembed/1.0/proxy', { url } ) } );\n\t\tyield receiveEmbedPreview( url, embedProxyResponse );\n\t} catch ( error ) {\n\t\t// Embed API 404s if the URL cannot be embedded, so we have to catch the error from the apiRequest here.\n\t\tyield receiveEmbedPreview( url, false );\n\t}\n}\n\n/**\n * Requests Upload Permissions from the REST API.\n *\n * @deprecated since 5.0. Callers should use the more generic `canUser()` selector instead of\n *            `hasUploadPermissions()`, e.g. `canUser( 'create', 'media' )`.\n */\nexport function* hasUploadPermissions() {\n\tdeprecated( \"select( 'core' ).hasUploadPermissions()\", {\n\t\talternative: \"select( 'core' ).canUser( 'create', 'media' )\",\n\t} );\n\tyield* canUser( 'create', 'media' );\n}\n\n/**\n * Checks whether the current user can perform the given action on the given\n * REST resource.\n *\n * @param {string}  action   Action to check. One of: 'create', 'read', 'update',\n *                           'delete'.\n * @param {string}  resource REST resource to check, e.g. 'media' or 'posts'.\n * @param {?string} id       ID of the rest resource to check.\n */\nexport function* canUser( action, resource, id ) {\n\tconst methods = {\n\t\tcreate: 'POST',\n\t\tread: 'GET',\n\t\tupdate: 'PUT',\n\t\tdelete: 'DELETE',\n\t};\n\n\tconst method = methods[ action ];\n\tif ( ! method ) {\n\t\tthrow new Error( `'${ action }' is not a valid action.` );\n\t}\n\n\tconst path = id ? `/wp/v2/${ resource }/${ id }` : `/wp/v2/${ resource }`;\n\n\tlet response;\n\ttry {\n\t\tresponse = yield apiFetch( {\n\t\t\tpath,\n\t\t\t// Ideally this would always be an OPTIONS request, but unfortunately there's\n\t\t\t// a bug in the REST API which causes the Allow header to not be sent on\n\t\t\t// OPTIONS requests to /posts/:id routes.\n\t\t\t// https://core.trac.wordpress.org/ticket/45753\n\t\t\tmethod: id ? 'GET' : 'OPTIONS',\n\t\t\tparse: false,\n\t\t} );\n\t} catch ( error ) {\n\t\t// Do nothing if our OPTIONS request comes back with an API error (4xx or\n\t\t// 5xx). The previously determined isAllowed value will remain in the store.\n\t\treturn;\n\t}\n\n\tlet allowHeader;\n\tif ( hasIn( response, [ 'headers', 'get' ] ) ) {\n\t\t// If the request is fetched using the fetch api, the header can be\n\t\t// retrieved using the 'get' method.\n\t\tallowHeader = response.headers.get( 'allow' );\n\t} else {\n\t\t// If the request was preloaded server-side and is returned by the\n\t\t// preloading middleware, the header will be a simple property.\n\t\tallowHeader = get( response, [ 'headers', 'Allow' ], '' );\n\t}\n\n\tconst key = compact( [ action, resource, id ] ).join( '/' );\n\tconst isAllowed = includes( allowHeader, method );\n\tyield receiveUserPermission( key, isAllowed );\n}\n\n/**\n * Request autosave data from the REST API.\n *\n * @param {string} postType The type of the parent post.\n * @param {number} postId   The id of the parent post.\n */\nexport function* getAutosaves( postType, postId ) {\n\tconst { rest_base: restBase } = yield resolveSelect( 'getPostType', postType );\n\tconst autosaves = yield apiFetch( { path: `/wp/v2/${ restBase }/${ postId }/autosaves?context=edit` } );\n\n\tif ( autosaves && autosaves.length ) {\n\t\tyield receiveAutosaves( postId, autosaves );\n\t}\n}\n\n/**\n * Request autosave data from the REST API.\n *\n * This resolver exists to ensure the underlying autosaves are fetched via\n * `getAutosaves` when a call to the `getAutosave` selector is made.\n *\n * @param {string} postType The type of the parent post.\n * @param {number} postId   The id of the parent post.\n */\nexport function* getAutosave( postType, postId ) {\n\tyield resolveSelect( 'getAutosaves', postType, postId );\n}\n"]}