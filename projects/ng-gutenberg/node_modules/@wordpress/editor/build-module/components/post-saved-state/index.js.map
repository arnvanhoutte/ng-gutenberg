{"version":3,"sources":["@wordpress/editor/src/components/post-saved-state/index.js"],"names":["classnames","get","__","Animate","Dashicon","Button","IconButton","Component","withSelect","withDispatch","displayShortcut","withSafeTimeout","compose","withViewportMatch","PostSwitchToDraftButton","PostSavedState","arguments","state","forceSavedMessage","prevProps","isSaving","props","setState","setTimeout","post","isNew","isScheduled","isPublished","isDirty","isSaveable","onSave","isAutosaving","isPending","isLargeViewport","classes","animateClassName","className","hasPublishAction","label","primary","select","forceIsDirty","forceIsSaving","isEditedPostNew","isCurrentPostPublished","isCurrentPostScheduled","isEditedPostDirty","isSavingPost","isEditedPostSaveable","getCurrentPost","isAutosavingPost","getEditedPostAttribute","dispatch","savePost"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\nimport { get } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Animate, Dashicon, Button, IconButton } from '@wordpress/components';\nimport { Component } from '@wordpress/element';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport { displayShortcut } from '@wordpress/keycodes';\nimport { withSafeTimeout, compose } from '@wordpress/compose';\nimport { withViewportMatch } from '@wordpress/viewport';\n\n/**\n * Internal dependencies\n */\nimport PostSwitchToDraftButton from '../post-switch-to-draft-button';\n\n/**\n * Component showing whether the post is saved or not and displaying save links.\n *\n * @param   {Object}    Props Component Props.\n */\nexport class PostSavedState extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.state = {\n\t\t\tforceSavedMessage: false,\n\t\t};\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tif ( prevProps.isSaving && ! this.props.isSaving ) {\n\t\t\tthis.setState( { forceSavedMessage: true } );\n\t\t\tthis.props.setTimeout( () => {\n\t\t\t\tthis.setState( { forceSavedMessage: false } );\n\t\t\t}, 1000 );\n\t\t}\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tpost,\n\t\t\tisNew,\n\t\t\tisScheduled,\n\t\t\tisPublished,\n\t\t\tisDirty,\n\t\t\tisSaving,\n\t\t\tisSaveable,\n\t\t\tonSave,\n\t\t\tisAutosaving,\n\t\t\tisPending,\n\t\t\tisLargeViewport,\n\t\t} = this.props;\n\t\tconst { forceSavedMessage } = this.state;\n\t\tif ( isSaving ) {\n\t\t\t// TODO: Classes generation should be common across all return\n\t\t\t// paths of this function, including proper naming convention for\n\t\t\t// the \"Save Draft\" button.\n\t\t\tconst classes = classnames( 'editor-post-saved-state', 'is-saving', {\n\t\t\t\t'is-autosaving': isAutosaving,\n\t\t\t} );\n\n\t\t\treturn (\n\t\t\t\t<Animate type=\"loading\">\n\t\t\t\t\t{ ( { className: animateClassName } ) => (\n\t\t\t\t\t\t<span className={ classnames( classes, animateClassName ) }>\n\t\t\t\t\t\t\t<Dashicon icon=\"cloud\" />\n\t\t\t\t\t\t\t{ isAutosaving ? __( 'Autosaving' ) : __( 'Saving' ) }\n\t\t\t\t\t\t</span>\n\t\t\t\t\t) }\n\t\t\t\t</Animate>\n\t\t\t);\n\t\t}\n\n\t\tif ( isPublished || isScheduled ) {\n\t\t\treturn <PostSwitchToDraftButton />;\n\t\t}\n\n\t\tif ( ! isSaveable ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif ( forceSavedMessage || ( ! isNew && ! isDirty ) ) {\n\t\t\treturn (\n\t\t\t\t<span className=\"editor-post-saved-state is-saved\">\n\t\t\t\t\t<Dashicon icon=\"saved\" />\n\t\t\t\t\t{ __( 'Saved' ) }\n\t\t\t\t</span>\n\t\t\t);\n\t\t}\n\n\t\t// Once the post has been submitted for review this button\n\t\t// is not needed for the contributor role.\n\t\tconst hasPublishAction = get( post, [ '_links', 'wp:action-publish' ], false );\n\t\tif ( ! hasPublishAction && isPending ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst label = isPending ? __( 'Save as Pending' ) : __( 'Save Draft' );\n\t\tif ( ! isLargeViewport ) {\n\t\t\treturn (\n\t\t\t\t<IconButton\n\t\t\t\t\tclassName=\"editor-post-save-draft\"\n\t\t\t\t\tlabel={ label }\n\t\t\t\t\tonClick={ () => onSave() }\n\t\t\t\t\tshortcut={ displayShortcut.primary( 's' ) }\n\t\t\t\t\ticon=\"cloud-upload\"\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\n\t\treturn (\n\t\t\t<Button\n\t\t\t\tclassName=\"editor-post-save-draft\"\n\t\t\t\tonClick={ () => onSave() }\n\t\t\t\tshortcut={ displayShortcut.primary( 's' ) }\n\t\t\t\tisTertiary\n\t\t\t>\n\t\t\t\t{ label }\n\t\t\t</Button>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select, { forceIsDirty, forceIsSaving } ) => {\n\t\tconst {\n\t\t\tisEditedPostNew,\n\t\t\tisCurrentPostPublished,\n\t\t\tisCurrentPostScheduled,\n\t\t\tisEditedPostDirty,\n\t\t\tisSavingPost,\n\t\t\tisEditedPostSaveable,\n\t\t\tgetCurrentPost,\n\t\t\tisAutosavingPost,\n\t\t\tgetEditedPostAttribute,\n\t\t} = select( 'core/editor' );\n\t\treturn {\n\t\t\tpost: getCurrentPost(),\n\t\t\tisNew: isEditedPostNew(),\n\t\t\tisPublished: isCurrentPostPublished(),\n\t\t\tisScheduled: isCurrentPostScheduled(),\n\t\t\tisDirty: forceIsDirty || isEditedPostDirty(),\n\t\t\tisSaving: forceIsSaving || isSavingPost(),\n\t\t\tisSaveable: isEditedPostSaveable(),\n\t\t\tisAutosaving: isAutosavingPost(),\n\t\t\tisPending: 'pending' === getEditedPostAttribute( 'status' ),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => ( {\n\t\tonSave: dispatch( 'core/editor' ).savePost,\n\t} ) ),\n\twithSafeTimeout,\n\twithViewportMatch( { isLargeViewport: 'small' } ),\n] )( PostSavedState );\n"]}