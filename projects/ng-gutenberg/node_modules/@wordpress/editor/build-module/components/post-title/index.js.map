{"version":3,"sources":["@wordpress/editor/src/components/post-title/index.js"],"names":["Textarea","classnames","get","__","Component","decodeEntities","ENTER","withSelect","withDispatch","KeyboardShortcuts","withFocusOutside","withInstanceId","compose","PostPermalink","PostTypeSupportCheck","REGEXP_NEWLINES","PostTitle","arguments","onChange","bind","onSelect","onUnselect","onKeyDown","redirectHistory","state","isSelected","setState","props","clearSelectedBlock","event","newTitle","target","value","replace","onUpdate","keyCode","preventDefault","onEnterPress","shiftKey","onRedo","onUndo","hasFixedToolbar","isCleanNewPost","isFocusMode","isPostTypeViewable","instanceId","placeholder","title","className","decodedPlaceholder","document","body","activeElement","applyWithSelect","select","getEditedPostAttribute","getSettings","getPostType","postType","titlePlaceholder","focusMode","applyWithDispatch","dispatch","insertDefaultBlock","editPost","undo","redo","undefined"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport Textarea from 'react-autosize-textarea';\nimport classnames from 'classnames';\nimport { get } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Component } from '@wordpress/element';\nimport { decodeEntities } from '@wordpress/html-entities';\nimport { ENTER } from '@wordpress/keycodes';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport { KeyboardShortcuts, withFocusOutside } from '@wordpress/components';\nimport { withInstanceId, compose } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport PostPermalink from '../post-permalink';\nimport PostTypeSupportCheck from '../post-type-support-check';\n\n/**\n * Constants\n */\nconst REGEXP_NEWLINES = /[\\r\\n]+/g;\n\nclass PostTitle extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.onChange = this.onChange.bind( this );\n\t\tthis.onSelect = this.onSelect.bind( this );\n\t\tthis.onUnselect = this.onUnselect.bind( this );\n\t\tthis.onKeyDown = this.onKeyDown.bind( this );\n\t\tthis.redirectHistory = this.redirectHistory.bind( this );\n\n\t\tthis.state = {\n\t\t\tisSelected: false,\n\t\t};\n\t}\n\n\thandleFocusOutside() {\n\t\tthis.onUnselect();\n\t}\n\n\tonSelect() {\n\t\tthis.setState( { isSelected: true } );\n\t\tthis.props.clearSelectedBlock();\n\t}\n\n\tonUnselect() {\n\t\tthis.setState( { isSelected: false } );\n\t}\n\n\tonChange( event ) {\n\t\tconst newTitle = event.target.value.replace( REGEXP_NEWLINES, ' ' );\n\t\tthis.props.onUpdate( newTitle );\n\t}\n\n\tonKeyDown( event ) {\n\t\tif ( event.keyCode === ENTER ) {\n\t\t\tevent.preventDefault();\n\t\t\tthis.props.onEnterPress();\n\t\t}\n\t}\n\n\t/**\n\t * Emulates behavior of an undo or redo on its corresponding key press\n\t * combination. This is a workaround to React's treatment of undo in a\n\t * controlled textarea where characters are updated one at a time.\n\t * Instead, leverage the store's undo handling of title changes.\n\t *\n\t * @see https://github.com/facebook/react/issues/8514\n\t *\n\t * @param {KeyboardEvent} event Key event.\n\t */\n\tredirectHistory( event ) {\n\t\tif ( event.shiftKey ) {\n\t\t\tthis.props.onRedo();\n\t\t} else {\n\t\t\tthis.props.onUndo();\n\t\t}\n\n\t\tevent.preventDefault();\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\thasFixedToolbar,\n\t\t\tisCleanNewPost,\n\t\t\tisFocusMode,\n\t\t\tisPostTypeViewable,\n\t\t\tinstanceId,\n\t\t\tplaceholder,\n\t\t\ttitle,\n\t\t} = this.props;\n\t\tconst { isSelected } = this.state;\n\n\t\t// The wp-block className is important for editor styles.\n\t\tconst className = classnames( 'wp-block editor-post-title__block', {\n\t\t\t'is-selected': isSelected,\n\t\t\t'is-focus-mode': isFocusMode,\n\t\t\t'has-fixed-toolbar': hasFixedToolbar,\n\t\t} );\n\t\tconst decodedPlaceholder = decodeEntities( placeholder );\n\n\t\treturn (\n\t\t\t<PostTypeSupportCheck supportKeys=\"title\">\n\t\t\t\t<div className=\"editor-post-title\">\n\t\t\t\t\t<div className={ className }>\n\t\t\t\t\t\t<KeyboardShortcuts\n\t\t\t\t\t\t\tshortcuts={ {\n\t\t\t\t\t\t\t\t'mod+z': this.redirectHistory,\n\t\t\t\t\t\t\t\t'mod+shift+z': this.redirectHistory,\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<label htmlFor={ `post-title-${ instanceId }` } className=\"screen-reader-text\">\n\t\t\t\t\t\t\t\t{ decodedPlaceholder || __( 'Add title' ) }\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\tid={ `post-title-${ instanceId }` }\n\t\t\t\t\t\t\t\tclassName=\"editor-post-title__input\"\n\t\t\t\t\t\t\t\tvalue={ title }\n\t\t\t\t\t\t\t\tonChange={ this.onChange }\n\t\t\t\t\t\t\t\tplaceholder={ decodedPlaceholder || __( 'Add title' ) }\n\t\t\t\t\t\t\t\tonFocus={ this.onSelect }\n\t\t\t\t\t\t\t\tonKeyDown={ this.onKeyDown }\n\t\t\t\t\t\t\t\tonKeyPress={ this.onUnselect }\n\t\t\t\t\t\t\t\t/*\n\t\t\t\t\t\t\t\t\tOnly autofocus the title when the post is entirely empty.\n\t\t\t\t\t\t\t\t\tThis should only happen for a new post, which means we\n\t\t\t\t\t\t\t\t\tfocus the title on new post so the author can start typing\n\t\t\t\t\t\t\t\t\tright away, without needing to click anything.\n\t\t\t\t\t\t\t\t*/\n\t\t\t\t\t\t\t\t/* eslint-disable jsx-a11y/no-autofocus */\n\t\t\t\t\t\t\t\tautoFocus={ document.body === document.activeElement && isCleanNewPost }\n\t\t\t\t\t\t\t\t/* eslint-enable jsx-a11y/no-autofocus */\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</KeyboardShortcuts>\n\t\t\t\t\t\t{ isSelected && isPostTypeViewable && <PostPermalink /> }\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</PostTypeSupportCheck>\n\t\t);\n\t}\n}\n\nconst applyWithSelect = withSelect( ( select ) => {\n\tconst { getEditedPostAttribute, isCleanNewPost } = select( 'core/editor' );\n\tconst { getSettings } = select( 'core/block-editor' );\n\tconst { getPostType } = select( 'core' );\n\tconst postType = getPostType( getEditedPostAttribute( 'type' ) );\n\tconst { titlePlaceholder, focusMode, hasFixedToolbar } = getSettings();\n\n\treturn {\n\t\tisCleanNewPost: isCleanNewPost(),\n\t\ttitle: getEditedPostAttribute( 'title' ),\n\t\tisPostTypeViewable: get( postType, [ 'viewable' ], false ),\n\t\tplaceholder: titlePlaceholder,\n\t\tisFocusMode: focusMode,\n\t\thasFixedToolbar,\n\t};\n} );\n\nconst applyWithDispatch = withDispatch( ( dispatch ) => {\n\tconst {\n\t\tinsertDefaultBlock,\n\t\tclearSelectedBlock,\n\t} = dispatch( 'core/block-editor' );\n\tconst {\n\t\teditPost,\n\t\tundo,\n\t\tredo,\n\t} = dispatch( 'core/editor' );\n\n\treturn {\n\t\tonEnterPress() {\n\t\t\tinsertDefaultBlock( undefined, undefined, 0 );\n\t\t},\n\t\tonUpdate( title ) {\n\t\t\teditPost( { title } );\n\t\t},\n\t\tonUndo: undo,\n\t\tonRedo: redo,\n\t\tclearSelectedBlock,\n\t};\n} );\n\nexport default compose(\n\tapplyWithSelect,\n\tapplyWithDispatch,\n\twithInstanceId,\n\twithFocusOutside\n)( PostTitle );\n"]}