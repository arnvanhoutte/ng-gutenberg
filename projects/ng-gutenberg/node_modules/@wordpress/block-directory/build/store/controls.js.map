{"version":3,"sources":["@wordpress/block-directory/src/store/controls.js"],"names":["loadAssets","select","storeName","selectorName","args","type","dispatch","dispatcherName","apiFetch","request","loadScript","asset","onLoad","onError","existing","document","querySelector","src","parentNode","removeChild","script","createElement","onload","onerror","body","appendChild","loadStyle","link","rel","href","assets","controls","SELECT","registry","DISPATCH","API_FETCH","LOAD_ASSETS","Promise","resolve","reject","Array","isArray","scriptsCount","match","editor_script","style"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { forEach } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { createRegistryControl } from '@wordpress/data';\nimport wpApiFetch from '@wordpress/api-fetch';\n\n/**\n * Calls a selector using the current state.\n *\n * @param {string} storeName    Store name.\n * @param {string} selectorName Selector name.\n * @param {Array}  args         Selector arguments.\n *\n * @return {Object} Control descriptor.\n */\nexport function select( storeName, selectorName, ...args ) {\n\treturn {\n\t\ttype: 'SELECT',\n\t\tstoreName,\n\t\tselectorName,\n\t\targs,\n\t};\n}\n\n/**\n * Calls a dispatcher using the current state.\n *\n * @param {string} storeName      Store name.\n * @param {string} dispatcherName Dispatcher name.\n * @param {Array}  args           Selector arguments.\n *\n * @return {Object} Control descriptor.\n */\nexport function dispatch( storeName, dispatcherName, ...args ) {\n\treturn {\n\t\ttype: 'DISPATCH',\n\t\tstoreName,\n\t\tdispatcherName,\n\t\targs,\n\t};\n}\n\n/**\n * Trigger an API Fetch request.\n *\n * @param {Object} request API Fetch Request Object.\n *\n * @return {Object} Control descriptor.\n */\nexport function apiFetch( request ) {\n\treturn {\n\t\ttype: 'API_FETCH',\n\t\trequest,\n\t};\n}\n\n/**\n * Loads JavaScript\n *\n * @param {Array}    asset   The url for the JavaScript.\n * @param {Function} onLoad  Callback function on success.\n * @param {Function} onError Callback function on failure.\n */\nconst loadScript = ( asset, onLoad, onError ) => {\n\tif ( ! asset ) {\n\t\treturn;\n\t}\n\tconst existing = document.querySelector( `script[src=\"${ asset.src }\"]` );\n\tif ( existing ) {\n\t\texisting.parentNode.removeChild( existing );\n\t}\n\tconst script = document.createElement( 'script' );\n\tscript.src = typeof asset === 'string' ? asset : asset.src;\n\tscript.onload = onLoad;\n\tscript.onerror = onError;\n\tdocument.body.appendChild( script );\n};\n\n/**\n * Loads CSS file.\n *\n * @param {*} asset the url for the CSS file.\n */\nconst loadStyle = ( asset ) => {\n\tif ( ! asset ) {\n\t\treturn;\n\t}\n\tconst link = document.createElement( 'link' );\n\tlink.rel = 'stylesheet';\n\tlink.href = typeof asset === 'string' ? asset : asset.src;\n\tdocument.body.appendChild( link );\n};\n\n/**\n * Load the asset files for a block\n *\n * @param {Array} assets A collection of URL for the assets.\n *\n * @return {Object} Control descriptor.\n */\nexport function* loadAssets( assets ) {\n\treturn {\n\t\ttype: 'LOAD_ASSETS',\n\t\tassets,\n\t};\n}\n\nconst controls = {\n\tSELECT: createRegistryControl( ( registry ) => ( { storeName, selectorName, args } ) => {\n\t\treturn registry.select( storeName )[ selectorName ]( ...args );\n\t} ),\n\tDISPATCH: createRegistryControl( ( registry ) => ( { storeName, dispatcherName, args } ) => {\n\t\treturn registry.dispatch( storeName )[ dispatcherName ]( ...args );\n\t} ),\n\tAPI_FETCH( { request } ) {\n\t\treturn wpApiFetch( { ... request } );\n\t},\n\tLOAD_ASSETS( { assets } ) {\n\t\treturn new Promise( ( resolve, reject ) => {\n\t\t\tif ( Array.isArray( assets ) ) {\n\t\t\t\tlet scriptsCount = 0;\n\n\t\t\t\tforEach( assets, ( asset ) => {\n\t\t\t\t\tif ( asset.match( /\\.js$/ ) !== null ) {\n\t\t\t\t\t\tscriptsCount++;\n\t\t\t\t\t\tloadScript( asset, () => {\n\t\t\t\t\t\t\tscriptsCount--;\n\t\t\t\t\t\t\tif ( scriptsCount === 0 ) {\n\t\t\t\t\t\t\t\treturn resolve( scriptsCount );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, reject );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tloadStyle( asset );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tloadScript( assets.editor_script, () => {\n\t\t\t\t\treturn resolve( 0 );\n\t\t\t\t}, reject );\n\t\t\t\tloadStyle( assets.style );\n\t\t\t}\n\t\t} );\n\t},\n};\n\nexport default controls;\n"]}